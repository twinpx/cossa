<!--#set var="page" value="create_event" -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru">
<head>
<!--#include virtual="/blocks/meta.html"-->
<script src="/js/editor/js/redactor/redactor.js" type="text/javascript"></script>
<link rel="stylesheet" href="/js/editor/js/redactor/css/redactor.css" />
<script type="text/javascript">
$(function(){
	$("#textarea1").redactor({toolbar:"cossa"});
	$("#textarea2").redactor({toolbar:"cossa"});
});
</script>
<title>Cossa</title>
</head>

<body>
	<!--#include virtual="/blocks/user_menu.html"-->
	<!--#include virtual="/blocks/head.html"-->
	<!--#include virtual="/blocks/top_navigation.html"-->
				<div id="content" class="page">
					<script type="text/javascript">
						cityAutocompleteArray = ["Магадан","Магас","Магнитогорск","Майкоп","Муром","Мценск","Мыски","Мытищи","Мышкин"];
						organizerAutocompleteArray = ["Медиург","Paprika","Новый интернет","Smetana","Айлав","Affect","Mosaic","Social Craft","QSoft"];
					</script>
					<div id="form_section">
						<h1>Создание события</h1>
						<div id="file-uploader-demo1"></div>
						<form action="" method="get" enctype="multipart/form-data">
							<div class="form_field">
								<h5>Заголовок <span class="no_text">?</span></h5>
								<div class="note"><div>Заголовок не должен превышать 100 символов. </div></div>
								<input type="text" name="heading" class="text" value="" />
							</div>
<div class="form_field teaser_img">
	<h5>Тизер<span class="no_text">?</span></h5>
	<div class="note"><div>Красивые, яркие картинки помогут сделать ваш пост заметным и привлекательным.</div></div>
		<div class="empty image"><div><p>Изображение не должно быть меньше чем 200 x 200 пикселей и не превышать 1 MB</p></div></div>
	<input type="hidden" value="" name="PROPERTY[DETAIL_PICTURE][0]" />
	<div id="file-uploader"></div>
	<div class="clear"></div>
</div>
							<div class="form_field teaser_img">
								<h5>Тизер <span class="no_text">?</span></h5>
								<div class="note"><div>Красивые, яркие картинки помогут сделать ваш пост заметным и привлекательным.</div></div>
								<div class="empty"><div><p>Изображение не должно быть меньше чем 200 x 200 пикселей и не превышать 1 MB</p></div></div>
								<div class="preview"><img src="/upload/gallery/3.jpg" width="200" height="200" alt="" /></div>
								<div class="file"><input type="file" name="teaser_img" /></div>
								<label class="checkbox"><input type="checkbox" name="tease" /> Оставить тизер в новости</label>
							</div>
							<div class="form_field date_field">
								<h5>Начало <span class="no_text">?</span></h5>
								<span class="date_field">
									<select name="beginning_day" class="day">
										<option>20</option>
										<option>21</option>
										<option>21</option>
									</select>
									<select name="beginning_month" class="month">
										<option value="02">февраля</option>
										<option value="06">июня</option>
										<option value="07">июля</option>
										<option value="08">августа</option>
										<option value="09">сентябрь</option>
										<option value="10">октябрь</option>
									</select>
									<select name="beginning_year" class="year">
										<option>2011</option>
										<option>2012</option>
										<option>2013</option>
									</select>
								</span>
								<span class="time">
									<select name="beginning_hour" class="hour">
										<option>08</option>
										<option>12</option>
										<option>13</option>
									</select>
									<span class="colon">:</span>
									<select name="beginning_minutes" class="minutes">
										<option>00</option>
										<option>15</option>
										<option>30</option>
									</select>
								</span>
							</div>
							<div class="form_field date_field">
								<h5>Окончание <span class="no_text">?</span></h5>
								<span class="date_field">
									<select name="ending_day" class="day">
										<option>20</option>
										<option>21</option>
										<option>21</option>
									</select>
									<select name="ending_month" class="month">
										<option value="02">февраля</option>
										<option value="06">июня</option>
										<option value="07">июля</option>
										<option value="08">августа</option>
										<option value="09">сентябрь</option>
										<option value="10">октябрь</option>
									</select>
									<select name="ending_year" class="year">
										<option>2011</option>
										<option>2012</option>
										<option>2013</option>
									</select>
								</span>
								<span class="time">
									<select name="ending_hour" class="hour">
										<option>18</option>
										<option>19</option>
										<option>20</option>
									</select>
									<span class="colon">:</span>
									<select name="ending_minutes" class="minutes">
										<option>00</option>
										<option>15</option>
										<option>30</option>
									</select>
								</span>
							</div>
							<div class="two">
								<!--<div class="form_field">
									<h5>Город <span class="no_text">?</span></h5>
									<input type="text" name="heading" class="text" value="" id="city_autocomplete" placeholder="Москва" />
								</div>-->
								<div class="form_field">
									<h5>Место <span class="no_text">?</span></h5>
									<input type="text" name="heading" class="text" value="" />
								</div>
								<div class="clear"></div>
							</div>
							<div class="form_field">
								<h5>Адрес <span class="no_text">?</span></h5>
								<input type="text" name="address" class="text" value="" />
							</div>
							<div class="two">
								<div class="form_field">
									<h5>Сайт <span class="no_text">?</span></h5>
									<input type="text" name="web" class="text web" value="" />
								</div>
								<div class="form_field">
									<h5>Телефон <span class="no_text">?</span></h5>
									<input type="text" name="phone" class="text phone" value="" />
								</div>
								<div class="clear"></div>
							</div>
							<!--<div class="form_field">
								<h5>Организатор <span class="no_text">?</span></h5>
								<input type="text" name="address" class="text" value="" id="organizer_autocomplete" />
							</div>-->
							<div class="form_field wage price">
								<h5>Стоимость <span class="no_text">?</span></h5>
								<input type="text" name="price_from" class="text" value="" placeholder="от" />
								<span class="mdash">&mdash;</span>
								<input type="text" name="price_to" class="text" value="" placeholder="до" />
								<span class="currency">руб.</span>
							</div>
							<hr />
							<div class="form_field entry">
								<h5>Текст поста <span class="no_text">?</span></h5>
								<textarea name="entry" cols="80" rows="20" id="textarea1"></textarea>
								<div class="draft_note">Черновик автоматически сохранён в 11:13:58 PM</div>
							</div>
							<div class="form_field entry">
								<h5>Текст поста <span class="no_text">?</span></h5>
								<textarea name="entry" cols="80" rows="20" id="textarea2"></textarea>
								<div class="draft_note">Черновик автоматически сохранён в 11:13:58 PM</div>
							</div>
							<div class="lecturer_fields">
								<div class="item">
									<div class="pad">
										<div class="form_field photo">
											<img src="/images/forms/empty_48x48.gif" width="48" height="48" alt="" class="image" />
											<input type="file" name="lecturer_photo" class="file" />
											<a href="#" class="delete_photo" rel="nofollow">Удалить</a>
										</div>
										<div class="form_field"><input type="text" name="lecturer_name" value="" placeholder="Имя и фамилия лектора" class="text" /></div>
										<div class="form_field"><textarea name="lecturer_info" rows="2" cols="10" placeholder="Краткая информация"></textarea></div>
										<a href="#" class="delete_item" rel="nofollow">Удалить</a>
									</div>
								</div>
								<a href="#" class="add" rel="nofollow">Добавить</a>
								<div class="clear"></div>
							</div>
							<div class="form_field">
								<h5>Теги <span class="no_text">?</span></h5>
								<div class="note"><div>Теги заполняются так: маркетинг, Гарри Поттер, менеджер и т.д.</div></div>
								<input type="text" name="tags" class="text" value="" />
							</div>
							<div class="buttons">
								<div class="note"><div>Материал отправлен в редакцию</div></div>
								<div class="submit"><input type="submit" value="Отправить" class="submit" name="submit_button" /></div>
								<div class="preview"><input type="submit" value="Просмотр" class="preview" /></div>
								<div class="draft"><input type="submit" value="" class="draft" /></div>
								<div class="clear"></div>
							</div>
						</form>
<script src="/js/fileuploader.js" type="text/javascript"></script>
<script src="/js/jquery.imgareaselect-0.9.8/js/jquery.imgareaselect.pack.js" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" href="/js/jquery.imgareaselect-0.9.8/css/imgareaselect-default.css" />
<script>   
	function createUploader(){
		var maxWidth = 305,
			maxHeight = 185,
			cropSelection = {},
			componentPath = "/bitrix/components/cossa/form.add/",
			uploader = new qq.FileUploader({
				multiple:false,
				element: document.getElementById('file-uploader'),
				action: '/bitrix/components/cossa/form.add/file.php',
				allowedExtensions: ['jpg', 'jpeg', 'png', 'gif'],
				params:{maxWidth:maxWidth},
				sizeLimit: 1048576, // max size
				showMessage:function(message) {
					$("#file-uploader").closest("div.teaser_img").find(".image").removeClass("empty").empty().height(266).html('<div id="teaser_message">'+message+'<\/div>');
				},
				onSubmit: function(id, fileName){
					$("#file-uploader").closest("div.teaser_img").find(".image").removeClass("empty").empty().height(266).html('<img src="/images/teaser_preloader.gif" id="teaser_preloader" \/>');
				},
				onComplete: function(id, fileName, responseJSON){
					function onPath() {
						var $divImage = $("#file-uploader").closest("div.teaser_img").find("div.image");
						uploader._options.params.remove_prev_image = "/upload/tmp"+responseJSON.path.split('/upload/tmp')[1];
						$("#file-uploader").find("div.apply").remove().end().find("li.qq-upload-fail").remove();
						var teaserImage = new Image;
						teaserImage.src = '/upload/tmp'+responseJSON.path.split("/upload/tmp")[1]+'';
						$divImage
							.removeClass("empty")
							.empty()
							.siblings("input:hidden").val('/upload/tmp'+responseJSON.path.split("/upload/tmp")[1]+'');
						setTimeout(function() {
							if(teaserImage.height!=0) {
								$divImage.append('<img src="/upload/tmp'+responseJSON.path.split("/upload/tmp")[1]+'" alt="" />');
								if(teaserImage.height < 266) {
									$divImage.height(266).find("img").css({marginTop:(266 - teaserImage.height)/2});
								}
								if(teaserImage.height > maxHeight) {
									$divImage.height(teaserImage.height).addClass("imgCrop").find("img").imgAreaSelect({
										x1: 0, y1: 0, x2: maxWidth, y2: maxHeight,
										aspectRatio:maxWidth+":"+maxHeight,
										persistent:true,
										resizable:false,
										onInit:function(img, selection) {
											cropSelection = selection;
										},
										onSelectEnd:function(img, selection) {
											cropSelection = selection;
										}
									}).end()
									.parent().find("div.qq-uploader").prepend('<div class="apply"><\/div>');
								}
							}
						}, 500)
							
						$("div.imgareaselect-outer").remove();
						$("div.imgareaselect-selection").parent().remove();
					}
					if(!responseJSON.path) {//exception for IE
						$.ajax({
							url:"/bitrix/components/cossa/form.add/file.php",
							type:"POST",
							data:{ie:true,path:componentPath+fileName, maxWidth:maxWidth, fileName:fileName},
							dataType:"JSON",
							success: function(data){
								responseJSON.path = data.path;
								onPath();
							}
						});
					}
					else {onPath();}
				}, 
				debug: true
			});
		$("div.form_field").delegate("div.apply", "click", function() {
			$.ajax({
			  url:"/bitrix/components/cossa/form.add/resize_crop.php",
			  type:"POST",
			  data:{src:$("#file-uploader").closest("div.teaser_img").find("input:hidden").val(), x1:cropSelection.x1, y1:cropSelection.y1, x2:cropSelection.x2, y2:cropSelection.y2, w:cropSelection.width, h:cropSelection.height},
			  dataType:"JSON",
				beforeSend:function(data) {
					$("#file-uploader").closest("div.teaser_img").find(".image").removeClass("empty").empty().height(266).html('<img src="/images/teaser_preloader.gif" id="teaser_preloader" \/>');
				},
			  success: function(data){
			 	 $("#file-uploader div.apply").remove();
				$("#file-uploader").closest("div.teaser_img").find("div.image").find("img").remove().end().prepend('<img src="/upload/tmp'+data.path.split("/upload/tmp")[1]+'?'+new Date().getTime()+'" />');
				var img = $("#file-uploader").closest("div.teaser_img").find("div.image").find("img");
				img.load(function() {
					if(img.height() < 266) {
						img.css({marginTop:(266 - img.height())/2});
					}
				});
				$("div.imgareaselect-outer").remove();
				$("div.imgareaselect-selection").parent().remove();
			  }
			});
			return false;
		});
	}
	
	// in your app create uploader as soon as the DOM is ready
	// don't wait for the window to load  
	window.onload = createUploader;
</script>

					</div>
				</div>
		<!--#include virtual="/blocks/footer.html"-->
<!--#include virtual="/blocks/popups.html"-->
</body>
</html>